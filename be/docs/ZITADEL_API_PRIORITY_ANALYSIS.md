# Zitadel API 추가 우선순위 분석

## 프로젝트 현황 분석

### 현재 아키텍처
- **인증 방식**: STATELESS JWT (세션 미사용)
- **조직 구조**: 단일 Organization (orgId 하나만 사용)
- **서비스 성격**: VPS 서비스 백엔드
- **현재 구현**: User API, Authorization API (v2)

### 현재 보안 설정
- `SessionCreationPolicy.STATELESS` - 세션 미사용
- JWT 기반 인증
- Role 기반 권한 관리 (`@PreAuthorize`)

---

## API 우선순위 평가

### 🔴 1순위: High Priority

#### 1. Session API
**필요성 평가**: ⭐⭐⭐ (중간)

**현재 상황:**
- STATELESS JWT 사용 중 → 세션 개념이 없음
- 하지만 보안 사고 시 강제 로그아웃은 필요할 수 있음

**활용 시나리오:**
- ✅ 보안 사고 발생 시 특정 사용자 강제 로그아웃
- ✅ 의심스러운 로그인 감지 시 세션 종료
- ✅ MFA 상태 확인 (현재는 JWT에 포함되어 있지만 추가 확인 필요 시)

**구현 권장도**: 🟡 **조건부 권장**
- 보안 요구사항이 높다면 구현 권장
- 현재는 STATELESS 구조이므로 우선순위는 중간
- **구현 시점**: 보안 정책이 명확해진 후

**구현 방식:**
```
ZitadelSessionExecutor 생성
- listUserSessions() - 사용자 세션 목록 조회
- terminateUserSession() - 특정 세션 종료
- terminateAllUserSessions() - 사용자 모든 세션 종료
```

---

#### 2. Organization API
**필요성 평가**: ⭐⭐⭐⭐⭐ (높음 - B2B인 경우)

**현재 상황:**
- 단일 Organization 구조
- `orgId` 하나만 사용 중

**활용 시나리오:**
- ✅ B2B 서비스: 여러 회사(조직) 관리
- ✅ 조직별 사용자 격리
- ✅ 조직별 설정 관리

**구현 권장도**: 🟢 **조건부 필수**
- **B2B 서비스라면**: 필수 구현
- **B2C 서비스라면**: 불필요
- **현재 판단**: 프로젝트 성격에 따라 결정 필요

**확인 필요 사항:**
- VPS 서비스가 B2B인가? (여러 회사가 각각 VPS를 관리)
- 아니면 B2C인가? (개인 사용자가 VPS를 구매)

**구현 방식:**
```
ZitadelOrganizationExecutor 생성
- createOrganization() - 조직 생성
- getOrganization() - 조직 조회
- updateOrganization() - 조직 수정
- listOrganizations() - 조직 목록 조회
```

---

### 🟡 2순위: Medium Priority

#### 3. Project API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- 프로젝트는 콘솔에서 수동 설정
- 대시보드에서 프로젝트 관리 기능 없음

**활용 시나리오:**
- 어드민 페이지에서 프로젝트 목록 조회
- 프로젝트 설정 변경

**구현 권장도**: 🔴 **현재 불필요**
- 콘솔에서 관리하는 것으로 충분
- 대시보드 기능이 필요해질 때 추가

---

#### 4. Application API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- OAuth2 Client는 `application.yaml`에서 설정
- API Key 발급 기능 없음

**활용 시나리오:**
- 사용자가 직접 API Key 발급받는 기능
- OAuth2 Client 동적 생성

**구현 권장도**: 🔴 **현재 불필요**
- API Key 발급 기능이 필요해질 때 추가
- 현재는 정적 설정으로 충분

---

#### 5. Settings API
**필요성 평가**: ⭐⭐ (낮음-중간)

**현재 상황:**
- 조직 설정은 콘솔에서 수동 변경
- 어드민 페이지에서 설정 변경 기능 없음

**활용 시나리오:**
- 어드민 페이지에서 로고 변경
- 비밀번호 정책 변경
- 테마 설정 변경

**구현 권장도**: 🟡 **나중에 추가 가능**
- 어드민 페이지가 구축될 때 추가
- 현재는 콘솔에서 관리하는 것으로 충분

---

### 🟢 3순위: Low Priority

#### 6. OIDC / SAML API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- Spring Security 설정으로 처리
- 프로토콜 수준의 설정은 코드에서 직접 호출 불필요

**구현 권장도**: 🔴 **불필요**
- Spring Security 설정으로 충분

---

#### 7. Action API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- 커스텀 스크립트는 콘솔에서 관리

**구현 권장도**: 🔴 **불필요**
- 콘솔에서 관리하는 것이 더 적합

---

#### 8. Identity Provider API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- 외부 로그인(구글, 카카오 등)은 콘솔에서 설정

**구현 권장도**: 🔴 **현재 불필요**
- 운영 중에 자주 변경하지 않으므로 콘솔에서 관리하는 것으로 충분
- 필요 시 나중에 추가 가능

---

#### 9. Instance / Feature API
**필요성 평가**: ⭐ (낮음)

**현재 상황:**
- 인스턴스 관리자 영역
- Feature Flag는 인프라 레벨 설정

**구현 권장도**: 🔴 **불필요**
- 인스턴스 관리자 영역이므로 애플리케이션 코드에서 접근 불필요

---

## 종합 권장사항

### 즉시 구현 권장 (조건부)

#### 1. Session API ⭐⭐⭐
**조건**: 보안 요구사항이 높은 경우
- 보안 사고 대응 필요
- 강제 로그아웃 기능 필요
- MFA 상태 모니터링 필요

**구현 시점**: 보안 정책 수립 후

#### 2. Organization API ⭐⭐⭐⭐⭐
**조건**: B2B 서비스인 경우
- 여러 회사(조직) 관리 필요
- 조직별 사용자 격리 필요

**구현 시점**: B2B 기능이 필요해질 때

---

### 나중에 추가 가능

#### Settings API
- 어드민 페이지 구축 시
- 사용자가 직접 설정 변경 기능 필요 시

#### Project API
- 대시보드에서 프로젝트 관리 기능 필요 시

#### Application API
- 사용자 API Key 발급 기능 필요 시

---

### 구현 불필요

- OIDC/SAML API
- Action API
- Identity Provider API
- Instance/Feature API

---

## 결론 및 제안

### 현재 단계에서 권장하는 접근

1. **현재는 추가 API 구현 보류**
   - 현재 구현된 User API, Authorization API로 충분
   - 통합 테스트 및 검증에 집중

2. **조건부 구현 대기**
   - **Session API**: 보안 정책이 명확해지면 구현
   - **Organization API**: B2B 기능이 필요해지면 구현

3. **점진적 확장**
   - 필요해질 때마다 추가하는 것이 효율적
   - 과도한 사전 구현은 유지보수 부담 증가

### 구현 우선순위 (조건부)

1. **Organization API** (B2B인 경우)
   - 여러 조직 관리가 핵심 기능이라면 최우선

2. **Session API** (보안 요구사항 높은 경우)
   - 강제 로그아웃, 세션 모니터링이 필요하면 구현

3. **Settings API** (어드민 페이지 구축 시)
   - 사용자가 직접 설정 변경이 필요하면 구현

---

## 다음 단계

1. **프로젝트 성격 확인**
   - B2B인가? B2C인가?
   - Organization API 필요 여부 결정

2. **보안 정책 수립**
   - Session 관리 정책
   - 강제 로그아웃 정책
   - Session API 필요 여부 결정

3. **현재 기능 검증**
   - 통합 테스트
   - 성능 테스트
   - 에러 처리 개선

4. **필요 시 점진적 추가**
   - 명확한 요구사항이 생길 때 추가

