spring:
  config:
    # .env 파일 로드 (프로젝트 루트 또는 be 디렉토리에서 찾음)
    import: optional:file:.env[.properties],optional:file:be/.env[.properties]

  application:
    name: OpenConsole

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:h2:mem:defaultdb}
    username: ${SPRING_DATASOURCE_USERNAME:sa}
    password: ${SPRING_DATASOURCE_PASSWORD:}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER:org.h2.Driver}

  jpa:
    hibernate:
      ddl-auto: ${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
    show-sql: ${SPRING_JPA_SHOW_SQL:false}
    properties:
      hibernate:
        dialect: ${SPRING_JPA_DIALECT:org.hibernate.dialect.H2Dialect}
        format_sql: true

  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 15MB

  output:
    ansi:
      enabled: ALWAYS


  # security
  security:
    oauth2:
      # OAuth2 Client: 로그인 플로우 (FE에서 리다이렉트)
      client:
        registration:
          zitadel: # registrationId
            client-id: ${ZITADEL_CLIENT_ID:}
            client-secret: ${ZITADEL_CLIENT_SECRET:}
            scope:
              - openid
              - profile
              - email
              # Zitadel Project role을 scope로 요청
              # 형식: urn:zitadel:iam:org:project:role:{roleName}
              # 또는 Project ID를 사용한 형식 (실제 Zitadel 설정에 맞게 조정 필요)
              - urn:zitadel:iam:org:project:role:admin
              - urn:zitadel:iam:org:project:role:userA
              - urn:zitadel:iam:org:project:role:userB
              - urn:zitadel:iam:org:project:role:userC
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/zitadel"
            client-name: ZITADEL
        provider:
          zitadel:
            issuer-uri: ${ZITADEL_ISSUER_URI:}
            user-name-attribute: sub # ID값으로 'sub'를 사용하겠다는 명시
      # OAuth2 Resource Server: JWT 토큰 검증 (API 요청 시)
      resourceserver:
        jwt:
          issuer-uri: ${ZITADEL_ISSUER_URI:} # JWKS 엔드포인트 자동 감지
          # JWT에서 role을 추출하기 위한 클레임 경로 설정
          # Zitadel의 경우 role은 보통 "urn:zitadel:iam:org:project:roles" 또는 "roles" 클레임에 있음

  # Spring AI: Vertex AI / OpenAI(호환) 설정
  ai:
    # Vertex AI Gemini 설정 (gcloud 인증 필요)
    vertex:
      ai:
        gemini:
          project-id: ${SPRING_AI_VERTEX_PROJECT_ID:}
          location: ${SPRING_AI_VERTEX_LOCATION:us-central1}
          chat:
            options:
              model: ${SPRING_AI_VERTEX_CHAT_OPTIONS_MODEL:gemini-2.0-flash}
              temperature: ${SPRING_AI_VERTEX_CHAT_OPTIONS_TEMPERATURE:0.5}

    # OpenAI
    openai:
      api-key: ${SPRING_AI_OPENAI_API_KEY:}
      chat:
        base-url: ${SPRING_AI_OPENAI_CHAT_BASE_URL:https://generativelanguage.googleapis.com/v1beta/openai/}
        completions-path: ${SPRING_AI_OPENAI_CHAT_COMPLETIONS_PATH:/chat/completions}
        options:
          model: ${SPRING_AI_OPENAI_CHAT_OPTIONS_MODEL:gemini-2.0-flash-lite}
          temperature: ${SPRING_AI_OPENAI_CHAT_OPTIONS_TEMPERATURE:0.0}
          max-tokens: ${SPRING_AI_OPENAI_CHAT_OPTIONS_MAX_TOKENS:1024}

logging:
  pattern:
    console: "%clr(%-5level){green} %clr(%logger.%M\\(\\)){cyan}: %msg%n"
  level:
    io:
      hlab:
        OpenConsole:
          infrastructure:
            security: DEBUG  # JWT role 추출 디버깅용
            iam:
              zitadel: DEBUG  # Zitadel API 호출 디버깅용
    org:
      springframework:
        ai:
          chat:
            client:
              advisor: DEBUG

zitadel:
  # domain은 프로토콜 포함 가능 (http:// 또는 https://) 또는 프로토콜 없이 도메인만
  # 프로토콜이 없으면 자동으로 https://가 추가됨
  domain: ${ZITADEL_DOMAIN:}
  org-id: ${ZITADEL_ORG_ID:}
  project-id: ${ZITADEL_PROJECT_ID:}
  api-token: ${ZITADEL_SERVICE_TOKEN:}